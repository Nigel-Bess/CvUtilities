name: Create Release Branch Every Thursday

on:
  schedule:
    - cron: '40 3 * * 6'

jobs:
  create-release-branch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Git
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@users.noreply.github.com"

      - name: Determine next version
        id: version
        run: |
          # Get the latest tag (semantic versioning)
          latest_tag=$(git tag -l | sort -V | tail -n 1)
          
          # Default to 0.0.0 if no tags exist yet
          if [ -z "$latest_tag" ]; then
            latest_tag="0.0.0"
          fi
          echo "Latest tag is: $latest_tag"
          
          # Increment the patch version (you can modify this logic if needed)
          # Split the version into major, minor, patch components
          IFS='.' read -r major minor patch <<< "$latest_tag"
          new_patch=$((patch + 1))  # Increment the patch version
          
          # Create the new version (we're incrementing the patch version here)
          new_version="$major.$minor.$new_patch"
          
          echo "Next version: $new_version"
          echo "new_version=$new_version" >> $GITHUB_ENV

      - name: Create release branch
        run: |
          # Get the new version from the environment variable
          BRANCH_NAME="release/v${{ env.new_version }}"
          
          # Create and push the new release branch
          git checkout main  # Adjust to your default branch name if it's not 'main'
          git pull origin main  # Ensure you have the latest changes
          git checkout -b $BRANCH_NAME  # Create the new release branch
          
          # Push the new branch to the repository
          git push origin $BRANCH_NAME
